<!DOCTYPE html>
<meta charset="utf-8">

<head>
	<title>Porings</title>
	<script src="https://d3js.org/d3.v5.min.js" type="text/JavaScript"></script>
	<script src="./utils.js" type="text/JavaScript"></script>
	<script src="./poring_selector.js" type="text/JavaScript"></script>
	<script src="./stats_diagram.js" type="text/JavaScript"></script>
</head>
<style>
	#selector_svg {
		/* write only numbers - to be parsed in d3 */
    height: 500px;
    width: 500px;
    border: 1px solid gray;
  }
	#statsDia_svg {
		/* write only numbers - to be parsed in d3 */
		height: 500px;
		width: 500px;
		border: 1px solid gray;
	}
</style>

<body>
	<svg id="selector_svg"></svg>
	<svg id="statsDia_svg"></svg>

	<script type="text/javascript">
		//d3.select('#selector').append('circle').attr('r', '100').attr('cx', 10).attr('cy', 10).attr('fill', 'red');




		var data = d3.csv("https://raw.githubusercontent.com/kor-al/porings/master/poring_family.csv")
			.then(function(data) {
				main(data);
			});



		function main(inData) {

			var nestedData = d3.nest()
				.key(function(d) {
					return d.viz_group;
				})
				.key(function(d) {
					return d.name;
				})
				.rollup(function(leaves) {
					return {
						"length": leaves.length,
						"values": leaves
					}
				})
				.entries(inData)
				.map(function(d) {
					return {
						group: d.key,
						mob_types: d.values
					};
				});

			nestedData.forEach(function(d) {
				d.group_size = d.mob_types.length
			});

			console.log(nestedData);
			createSelector(nestedData, "#selector_svg");
			createStatsDiagram(nestedData[0].mob_types[1].value.values, "#statsDia_svg");
		};
	</script>
</body>

</html>
